export ZOPEN_BUILD_LINE="DEV"
export ZOPEN_DEV_URL="https://chromium.googlesource.com/chromium/tools/depot_tools.git"
export ZOPEN_DEV_DEPS="python"
export ZOPEN_RUNTIME_DEPS="python"
export ZOPEN_BOOTSTRAP="python3"
export ZOPEN_PYTHONDIR=`type python3 | head -1 | sed "s:^.*[ (]/:/:;s:)$::"`
export ZOPEN_BOOTSTRAP_OPTS="bootstrap/bootstrap.py --bootstrap-name ${ZOPEN_PYTHONDIR}"
# Nothing to configure or build:
export ZOPEN_CONFIGURE="skip"
export ZOPEN_MAKE="skip"
export ZOPEN_INSTALL="zopen_install"

zopen_install() {
  mkdir -p $ZOPEN_INSTALL_DIR
  cp -r * $ZOPEN_INSTALL_DIR/ # modify to copy the relevant scripts
}

zopen_check_results()
{
  dir="$1"
  pfx="$2"
  chk="$1/$2_check.log"

  # Echo the following information to gauge build health
  echo "actualFailures:0"
  echo "totalTests:1"
  echo "expectedFailures:0"
  echo "expectedTotalTests:1"
}

zopen_append_to_env()
{
  # echo envars outside of PATH, MANPATH, LIBPATH

  # update the path for depot_tools
  #export PATH=${PATH}:${HOME}/zopen/dev/depot_toolsport/depot_tools
  # update the path for pip
  #export PATH=${PATH}:${HOME}/.local/bin
  # update the compiler settings
  # TODO: this can probably be moved to v8 build later
  echo "export CC=clang"
  echo "export CXX=clang++"
  echo "export LINK=clang++"
  # Disable updating depot_tools
  echo "export DEPOT_TOOLS_UPDATE=0"

  # Disable commands:
  # * ensure_bootstrap
  # * update_depot_tools
  echo "export DEPOT_TOOLS_BOOTSTRAP_PYTHON3=0"

  # Using depot_tools disable metrics.
  # Comment out this line if you wish to participate.
  #echo "gclient metrics --opt-out"
}


# Notes:
# These steps create this directory 
# /z/jd895801/zopen/usr/local/zopen/depot_tools
# during the `zopen build` process.
#
# This code is run when zopen build is issued
# and the CWD is ~/zopen/dev/depot_toolsport
#
# Example buildenvs which use this portion of 
# code are:
#
# https://github.com/ZOSOpenTools/sudoport/blob/main/buildenv#L49
#
# https://github.com/ZOSOpenTools/gpgport/blob/main/buildenv#L50
#
# Build workflow
# cd ~/zopen/dev/depot_toolsport
# rm ~/zopen/usr/local/zopen/depot_tools; rm install depot_tools; zopen build


zopen_append_to_setup()
{
# echo commands that will run when installing via setup.sh
# At this time, ZOPEN_INSTAL_DIR is:
# /z/jd895801/zopen/usr/local/zopen/depot_tools/depot_tools-main
echo "echo \"\tCreating a python venv...\""
echo "python3 -m venv venv"
echo "echo \"\tActivating python venv named venv...\""
echo "source ${ZOPEN_INSTALL_DIR}/venv/bin/activate"
echo "echo \"\tUpgrading pip in venv...\""
echo "python -m pip install -U pip"
echo "echo \"Installing packages via requirements.txt...\""
echo "pip install -r ${ZOPEN_INSTALL_DIR}/requirements.txt"
}

zopen_get_version()
{
  # Modify to echo the version of your tool/library
  # Rather than hardcoding the version, obtain the version by running the tool/library
  echo "1.0.0"
}
